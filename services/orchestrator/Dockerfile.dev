FROM node:20-alpine

ENV NPM_CONFIG_FUND=false \
    NPM_CONFIG_AUDIT=false

WORKDIR /app

# Bring in the whole monorepo so npm can resolve workspaces
COPY . .

# Upgrade npm and install all workspaces at repo root
RUN npm install -g npm@11 \
    && npm --version \
    && npm install --workspaces

# Build the shared logging lib (TS â†’ dist)
RUN npm -w packages/logging run build

# Run orchestrator in dev
WORKDIR /app/services/orchestrator
CMD ["npm", "run", "dev"]